"use strict";const{app:n,BrowserWindow:d,ipcMain:a}=require("electron"),s=require("path"),u=require("fs"),f=require("puppeteer-core"),w=s.join(__dirname,"../dist");n.isPackaged||s.join(__dirname,"../public");const p=s.join(__dirname,"../dist-electron/preload.js");let o=null,t=null;function h(){o=new d({width:1280,height:800,webPreferences:{preload:p,nodeIntegration:!1,contextIsolation:!0,sandbox:!1}}),process.env.VITE_DEV_SERVER_URL&&o?o.loadURL(process.env.VITE_DEV_SERVER_URL):o&&o.loadFile(s.join(w,"index.html")),!n.isPackaged&&o&&o.webContents.openDevTools()}a.handle("readCookies",()=>new Promise(r=>{const i=s.join(n.getPath("userData"),"cookies.json");u.readFile(i,"utf-8",(e,l)=>{e?(console.error("读取 cookies 失败:",e),r("[]")):r(l)})}));a.handle("saveCookies",async(r,i)=>new Promise(e=>{const l=s.join(n.getPath("userData"),"cookies.json");u.writeFile(l,i,"utf-8",c=>{c?(console.error("保存 cookies 失败:",c),e(!1)):e(!0)})}));a.handle("launchBrowser",async(r,i)=>{try{return t=await f.launch(i),t}catch(e){throw console.error("启动浏览器失败:",e),e}});a.handle("closeBrowser",async()=>{t&&(await t.close(),t=null)});n.whenReady().then(h);n.on("window-all-closed",()=>{process.platform!=="darwin"&&n.quit(),o=null});n.on("activate",()=>{d.getAllWindows().length===0&&h()});
